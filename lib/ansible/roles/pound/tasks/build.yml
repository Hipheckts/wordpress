---
- name:       Get prefix of outdated Pound installation
  shell:      "command -v pound | grep -i pound | perl -pe 's|^(.*?)/s?bin/pound$|$1|i'"
  register:   pound_install_prefix

- debug:      msg={{ pound_install_prefix.stdout }}

- name:       Fetch Pound 2.6 source package
  get_url:    url=http://www.apsis.ch/pound/Pound-2.6.tgz dest=/tmp/Pound-2.6.tgz

- name:       Unzip source package
  unarchive:  src=/tmp/Pound-2.6.tgz dest=/tmp/ copy=no

- name:       Build and install Pound 2.6 over outdated apt package
  command:    "{{ item }}"
  args:
    chdir:    /tmp/Pound-2.6
  sudo:       yes
  with_items:
   - ./configure --bindir={{ pound_install_prefix.stdout }}/bin --sbindir={{ pound_install_prefix.stdout }}/sbin --sysconfdir=/etc/pound --prefix=
   - make
   - make install

- name:       Register Pound major/minor version
  shell:      "pound -V 2>&1 | grep -i version | perl -pe 's|^.*?version ([0-9]+[.][0-9]+).*?$|$1|i'"
  register:   pound_build_version

- debug:      msg={{ pound_build_version.stdout }}
