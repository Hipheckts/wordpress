---
# https://launchpad.net/~unleashedtech/+archive/ubuntu/pound-2.7
- name:       Register pound 2.7 ppa
  apt_repository: repo='ppa:unleashedtech/pound-2.7'
  sudo:       true

- name:       Install pound package
  apt:        pkg=pound state=latest update_cache=yes
  sudo:       true

- name:       Copy pound configuration file
  template:   src=pound.cfg dest=/etc/pound/pound.cfg mode=0644
  notify:     restart pound
  sudo:       true

- name:       Copy SSL certificates
  copy:       src=./files/ssl/{{ item }}.{{ domain }}.pem dest=/etc/pound/{{ item }}.{{ domain }}.pem mode=0644
  with_items:
    - local
    - staging
    - production
  notify:     restart pound
  sudo:       true

- name:       Enable pound
  lineinfile: regexp='^startup=0' line='startup=1' dest=/etc/default/pound backup=yes
  notify:     restart pound
  sudo:       yes
