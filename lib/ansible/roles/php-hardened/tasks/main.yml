---
- name:           Disable allow_url_fopen
  lineinfile:     dest=/etc/php5/apache2/php.ini backup=yes regexp='^[;# ]*allow_url_fopen' line='allow_url_fopen = Off'
  sudo:           yes

- name:           Install repository key
  apt_key:        url=https://sektioneins.de/files/repository.asc state=present
  sudo:           yes

- name:           Configure repository source list
  apt_repository: repo='deb http://repo.suhosin.org/ ubuntu-trusty main' state=present
  sudo:           yes

- name:           Install Suhosin extension
  apt:            pkg=php5-suhosin-extension state=latest update_cache=yes
  sudo:           yes

- name:           Enable Suhosin
  command:        php5enmod suhosin
  sudo:           yes

- name:           Disable system calls from PHP userland
  lineinfile:     dest=/etc/php5/mods-available/suhosin.ini backup=yes regexp='^[;# ]*suhosin.executor.func.blacklist =' line='suhosin.executor.func.blacklist = {{ php_disable_functions | join(",") }}'
  sudo:           yes
  notify:         restart apache
